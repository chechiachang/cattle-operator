cattle-operator
===

Cattle-operator is an example operator generated by operator-sdk.

---

# Install operator-sdk Cli

https://github.com/operator-framework/operator-sdk/blob/master/doc/user/install-operator-sdk.md

```
$ go version
go version go1.12.4 linux/amd64

$ operator-sdk version
operator-sdk version: v0.8.0, commit: 78c472461e75e6c64589cfadf577a2004b8a26b3
```

---

# Get Started

https://github.com/operator-framework/getting-started

New operator
```
cd ${GOPATH}/src/github.com/chechiachang

export GO111MODULE=on
OPERATOR=cattle-operator
operator-sdk new ${OPERATOR}

$ tree -L 2
.
├── cattle-operator
│   ├── build
│   ├── cmd
│   ├── deploy
│   ├── go.mod
│   ├── go.sum
│   ├── pkg
│   ├── tools.go
│   ├── vendor
│   └── version
└── README.md
```

Add api and controller
```
API_VERSION=cattle.chechiachang.com/v1alpha1
CRD=Cattle
operator-sdk add api --api-version=${API_VERSION} --kind=${CRD}
operator-sdk add controller --api-version=${API_VERSION} --kind=${CRD}
```

# Update CRD

```
# Update CRD definition
vim pkg/apis/cattle/v1alpha1/cattle_types.go

# Update controller reconcile logic
vim pkg/controller/cattle/cattle_controller.go

make generate
```

# Deploy to kubernetes

(Grant extra privilege for serviceaccount rulebinding)

```
kubectl apply -f deploy/crds/cattle_v1alpha1_cattle_crd.yaml
kubectl apply -f deploy
```

